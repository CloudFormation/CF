{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Create VPC CF",
    "Parameters": {
        "AvailabilityZones": {
            "Description": "List of Availability Zones to use for the subnets in the VPC. Note: The logical order is preserved and only 2 AZs are used for this deployment.",
            "Type": "List<AWS::EC2::AvailabilityZone::Name>"
        },
        "VPCCIDR": {
            "AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))$",
            "Description": "CIDR Block for VPC",
            "Type": "String",
            "Default": "10.0.0.0/16"
        },
        "PublicSubnet1CIDR": {
            "AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))$",
            "Description": "CIDR Block for the public DMZ subnet 1 located in Availability Zone 1",
            "Type": "String",
            "Default": "10.0.11.0/24"
        },
        "PublicSubnet2CIDR": {
            "AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))$",
            "Description": "CIDR Block for the public DMZ subnet 2 located in Availability Zone 2",
            "Type": "String",
            "Default": "10.0.12.0/24"
        },
        "ProtectSubnet1CIDR": {
            "AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))$",
            "Description": "CIDR Block for the protect DMZ subnet 1 located in Availability Zone 1",
            "Type": "String",
            "Default": "10.0.21.0/24"
        },
        "ProtectSubnet2CIDR": {
            "AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))$",
            "Description": "CIDR Block for the protect DMZ subnet 2 located in Availability Zone 2",
            "Type": "String",
            "Default": "10.0.22.0/24"
        },
        "PrivateSubnet1CIDR": {
            "AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))$",
            "Description": "CIDR block for private subnet 1 located in Availability Zone 1.",
            "Type": "String",
            "Default": "10.0.31.0/24"
        },
        "PrivateSubnet2CIDR": {
            "AllowedPattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\/([0-9]|[1-2][0-9]|3[0-2]))$",
            "Description": "CIDR block for private subnet 2 located in Availability Zone 2.",
            "Type": "String",
            "Default": "10.0.32.0/24"
        }
    },
    "Resources": {
        "WinFSecurityGroup": {
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {
                "GroupDescription": "Allow http to client host",
                "VpcId": {
                    "Ref": "VPC"
                }
            }
        },
        "RouteTable1": {
            "Type": "AWS::EC2::RouteTable",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "WinFrontier-NAT"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "1448fe85-d3c2-40a6-bf86-2e2c7a1fbbf0"
                }
            }
        },
        "RouteTable2": {
            "Type": "AWS::EC2::RouteTable",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "WinFrontier-NAT"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "9aa2c1f3-73ae-43f5-b1b1-7bca604f5548"
                }
            }
        },
        "Nat": {
            "Properties": {
                "AllocationId": {
                    "Fn::GetAtt": [
                        "NatEip",
                        "AllocationId"
                    ]
                },
                "SubnetId": {
                    "Ref": "PublicSubnet1"
                }
            },
            "Type": "AWS::EC2::NatGateway",
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "06878774-22be-4e76-a6d0-38e8412766d8"
                }
            }
        },
        "NatEip": {
            "Properties": {
                "Domain": "vpc"
            },
            "Type": "AWS::EC2::EIP",
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "987c2cbb-e3f6-4aa3-8109-f9c50aa248cb"
                }
            }
        },
        "NatRoute": {
            "Properties": {
                "DestinationCidrBlock": "0.0.0.0/0",
                "NatGatewayId": {
                    "Ref": "Nat"
                },
                "RouteTableId": {
                    "Ref": "RouteTable1"
                }
            },
            "Type": "AWS::EC2::Route",
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "4b8e69af-bdf0-4f57-b40e-4be11e85dae9"
                }
            }
        },
        "Nat1": {
            "Properties": {
                "AllocationId": {
                    "Fn::GetAtt": [
                        "NatEip1",
                        "AllocationId"
                    ]
                },
                "SubnetId": {
                    "Ref": "PublicSubnet2"
                }
            },
            "Type": "AWS::EC2::NatGateway",
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "52bee7cc-3d6a-4508-8d42-10ee5a567322"
                }
            }
        },
        "NatEip1": {
            "Properties": {
                "Domain": "vpc"
            },
            "Type": "AWS::EC2::EIP",
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "a5aaeb8b-d2af-4a97-8be4-3ccc64e629af"
                }
            }
        },
        "NatRoute1": {
            "Properties": {
                "DestinationCidrBlock": "0.0.0.0/0",
                "NatGatewayId": {
                    "Ref": "Nat1"
                },
                "RouteTableId": {
                    "Ref": "RouteTable2"
                }
            },
            "Type": "AWS::EC2::Route",
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "38e71091-845f-4221-b158-305b9841c30a"
                }
            }
        },
        "VPC": {
            "Type": "AWS::EC2::VPC",
            "Properties": {
                "CidrBlock": {
                    "Ref": "VPCCIDR"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "WinfrontierVPC"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "5388fed8-17c6-40bf-8061-5e90399b56e1"
                }
            }
        },
        "InternetGateway": {
            "Type": "AWS::EC2::InternetGateway",
            "Properties": {
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "WinFrontier"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "cf4ca61e-8ed5-447b-8987-ece8e3445010"
                }
            }
        },
        "VPCGatewayAttachment": {
            "Type": "AWS::EC2::VPCGatewayAttachment",
            "Properties": {
                "InternetGatewayId": {
                    "Ref": "InternetGateway"
                },
                "VpcId": {
                    "Ref": "VPC"
                }
            },
            "DependsOn": [
                "InternetGateway"
            ],
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "21803643-b831-442c-ac28-f02675f8921f"
                }
            }
        },
        "PublicSubnet1": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "AvailabilityZone": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "AvailabilityZones"
                        }
                    ]
                },
                "CidrBlock": {
                    "Ref": "PublicSubnet1CIDR"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "WinFrontier-public-1"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "72f0f44c-395a-4c27-ba59-735f31bd3932"
                }
            }
        },
        "PublicSubnet2": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "AvailabilityZone": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "AvailabilityZones"
                        }
                    ]
                },
                "CidrBlock": {
                    "Ref": "PublicSubnet2CIDR"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "WinFrontier-public-2"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "64a4975e-8458-4b42-b5c6-dd023c367e8d"
                }
            }
        },
        "ProtectSubnet1": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "AvailabilityZone": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "AvailabilityZones"
                        }
                    ]
                },
                "CidrBlock": {
                    "Ref": "ProtectSubnet1CIDR"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "WinFrontier-protect-1"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "d8c9522e-16b9-46e5-8f34-a3e86dde2cec"
                }
            }
        },
        "ProtectSubnet2": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "AvailabilityZone": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "AvailabilityZones"
                        }
                    ]
                },
                "CidrBlock": {
                    "Ref": "ProtectSubnet2CIDR"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "WinFrontier-protect-2"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "7332612f-6351-4328-bfe7-dd753b40e939"
                }
            }
        },
        "PrivateSubnet1": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "AvailabilityZone": {
                    "Fn::Select": [
                        "0",
                        {
                            "Ref": "AvailabilityZones"
                        }
                    ]
                },
                "CidrBlock": {
                    "Ref": "PrivateSubnet1CIDR"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "WinFrontier-private-1"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "8e2badeb-d2ac-4a19-9401-c74e4ae865e5"
                }
            }
        },
        "PrivateSubnet2": {
            "Type": "AWS::EC2::Subnet",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "AvailabilityZone": {
                    "Fn::Select": [
                        "1",
                        {
                            "Ref": "AvailabilityZones"
                        }
                    ]
                },
                "CidrBlock": {
                    "Ref": "PrivateSubnet2CIDR"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "WinFrontier-private-2"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "0fead1d0-8388-4c95-8b53-e61fa6794bea"
                }
            }
        },
        "RouteTable": {
            "Type": "AWS::EC2::RouteTable",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "WinFrontier-public"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "86642253-0926-4aa7-8238-4a03b6b7d053"
                }
            }
        },
        "PublicSubnetRouteTableAssociation1": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "RouteTableId": {
                    "Ref": "RouteTable"
                },
                "SubnetId": {
                    "Ref": "PublicSubnet1"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "f113838c-6fdb-4d41-b573-4b36a69a017b"
                }
            },
            "DependsOn": [
                "PublicSubnet1"
            ]
        },
        "PublicSubnetRouteTableAssociation2": {
            "Type": "AWS::EC2::SubnetRouteTableAssociation",
            "Properties": {
                "RouteTableId": {
                    "Ref": "RouteTable"
                },
                "SubnetId": {
                    "Ref": "PublicSubnet2"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "63686c37-36f6-47b4-bd2d-a511f2f61369"
                }
            },
            "DependsOn": [
                "PublicSubnet2"
            ]
        },
        "Route": {
            "Type": "AWS::EC2::Route",
            "Properties": {
                "DestinationCidrBlock": "0.0.0.0/0",
                "RouteTableId": {
                    "Ref": "RouteTable"
                },
                "GatewayId": {
                    "Ref": "InternetGateway"
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "878644bd-a6dd-493d-95c8-ab6089ccfbec"
                }
            },
            "DependsOn": [
                "VPCGatewayAttachment"
            ]
        },
        "RouteTableNAT": {
            "Type": "AWS::EC2::RouteTable",
            "Properties": {
                "VpcId": {
                    "Ref": "VPC"
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "WinFrontier-public"
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "92c5b804-5724-4c92-9b1d-a2efee71e7fb"
                }
            }
        }
    },
    "Metadata": {
        "AWS::CloudFormation::Interface": {
            "ParameterGroups": [
                {
                    "Label": {
                        "default": "Network"
                    },
                    "Parameters": [
                        "VPCCIDR",
                        "AvailabilityZones",
                        "PublicSubnet1CIDR",
                        "PublicSubnet2CIDR",
                        "ProtectSubnet1CIDR",
                        "ProtectSubnet2CIDR",
                        "PrivateSubnet1CIDR",
                        "PrivateSubnet2CIDR"
                    ]
                }
            ]
        }
    },
    "Outputs": {
        "VPCId": {
            "Description": "VPC ID",
            "Value": {
                "Ref": "VPC"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${AWS::StackName}-VPC"
                }
            }
        },
        "PublicSubnet1": {
            "Description": "The subnet ID to use for public servers",
            "Value": {
                "Ref": "PublicSubnet1"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${AWS::StackName}-PublicSubnetID1"
                }
            }
        },
        "PublicSubnet2": {
            "Description": "The subnet ID to use for public servers",
            "Value": {
                "Ref": "PublicSubnet2"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${AWS::StackName}-PublicSubnetID2"
                }
            }
        },
        "ProtectSubnet1": {
            "Description": "The subnet ID to use for protect servers",
            "Value": {
                "Ref": "ProtectSubnet1"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${AWS::StackName}-ProtectSubnetID1"
                }
            }
        },
        "ProtectSubnet2": {
            "Description": "The subnet ID to use for protect servers",
            "Value": {
                "Ref": "ProtectSubnet2"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${AWS::StackName}-ProtectSubnetID2"
                }
            }
        },
        "PrivateSubnet1": {
            "Description": "The subnet ID to use for private servers",
            "Value": {
                "Ref": "PrivateSubnet1"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${AWS::StackName}-PrivateSubnetID1"
                }
            }
        },
        "PrivateSubnet2": {
            "Description": "The subnet ID to use for private servers",
            "Value": {
                "Ref": "PrivateSubnet2"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${AWS::StackName}-PrivateSubnetID2"
                }
            }
        },
        "RouteTable": {
            "Description": "Main Route Table",
            "Value": {
                "Ref": "RouteTable"
            },
            "Export": {
                "Name": {
                    "Fn::Sub": "${AWS::StackName}-RouteTableID"
                }
            }
        }
    }
}
